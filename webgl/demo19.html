<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ThreeJS 加载obj以及mtl模型</title>
    <script type="text/javascript" src="../lib/three.js"></script>
    <script type="text/javascript" src="../lib/three-obj-loader.js"></script>
    <script type="text/javascript" src="../lib/three-mtl-loader.js"></script>
    <script type="text/javascript" src="../lib/three-orbit-controls.js"></script>
    <style type="text/css">
        body{
            margin:0;
            padding:0;
            overflow:hidden;
        }
        div#canvas-frame {
            cursor: pointer;
            width:100%;
            height:100%;
            background-color: #EEEEEE;
        }
    </style>
</head>
<body onload="threeStart();">
<div id="canvas-frame"></div>
<script>
    var renderer;//渲染器
    var width;//页面宽度
    var height;//页面高度

    window.requestAnimFrame = (function() {//如果有变化则可能还需要requestAnimationFrame刷新
        return window.requestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                window.webkitRequestAnimationFrame;
    })();

    //开始
    function threeStart() {
        initThree();
        initCamera();
        initScene();
        initLight();
        initObject();
        render();
    }

    //根据页面宽度和高度创建渲染器，并添加容器中
    function initThree() {
        width = window.innerWidth;
        height = window.innerHeight;
        renderer = new THREE.WebGLRenderer({
            antialias : true
        });
        renderer.setSize(width, height);
        renderer.shadowMap.enabled = true;//打开渲染器的阴影地图
        renderer.setClearColor(0xFFFFFF, 1.0);
        document.getElementById('canvas-frame').appendChild(renderer.domElement);
    }

    //创建相机，并设置正方向和中心点
    var camera;
    var controller;
    function initCamera() {
        camera = new THREE.PerspectiveCamera(45, width / height, 1, 1000);
        camera.position.x = 0;
        camera.position.y = 0;
        camera.position.z = 600;
        camera.up.x = 0;//正方向
        camera.up.y = 1;
        camera.up.z = 0;
        camera.lookAt({
            x : 0,
            y : 0,
            z : 0
        });
        //视角控制
        controller = new THREE.OrbitControls(camera, renderer.domElement);
        controller.target = new THREE.Vector3(0, 0, 0);//设置控制点
    }

    //创建场景，后续元素需要加入到场景中才会显示出来
    var scene;
    function initScene() {
        scene = new THREE.Scene();
    }

    //创建光线
    var shadowLight;
    var hemisphereLight;
    var shadowLight2;

    function initLight() {
        //创建光线
        // 第一个参数是天空的颜色，第二个参数是地上的颜色，第三个参数是光源的强度
        hemisphereLight = new THREE.HemisphereLight(0xaaaaaa,0x000000, 1);

        scene.add(hemisphereLight);

        shadowLight = new THREE.DirectionalLight(0xffffff, .6);
        shadowLight.position.set(150,200,300);

        scene.add(shadowLight);

        shadowLight2 = new THREE.DirectionalLight(0xffffff, .6);
        shadowLight2.position.set(-150,-200,-300);
        scene.add(shadowLight2);
    }

    //创建展示场景所需的各种元素
    function initObject() {

        var mtlLoader = new THREE.MTLLoader();
        mtlLoader.setPath( './mtl/' );
        mtlLoader.load( 'monu9.mtl', function( materials ) {
            materials.preload();
            var objLoader = new THREE.OBJLoader();
            objLoader.setMaterials( materials );
            objLoader.setPath( './obj/' );
            objLoader.load( 'monu9.obj', function ( object ) {
                scene.add( object );
            }, function(xhr){
                if ( xhr.lengthComputable ) {
                    var percentComplete = xhr.loaded / xhr.total * 100;
                    console.log( Math.round(percentComplete, 2) + '% downloaded' );
                }
            }, function(xhr){
                console.log('error');
            });
        });
    }

    //渲染
    function render(){
        renderer.clear();
        renderer.render(scene, camera);
        window.requestAnimFrame(render);
    }
</script>
</body>
</html>
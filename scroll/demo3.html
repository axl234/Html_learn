<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>passive event listener</title>
    <style>
        body{
            margin:0;
            padding:0;
            -webkit-overflow-scrolling: touch;
        }
        .container{
            position: absolute;
            top:0;
            left:0;
            right:0;
            bottom:0;
            overflow-y:scroll;
            overflow-x:hidden;
        }
        .container ul{
            width:100%;
            overflow:hidden;
            max-height:initial;
            border-top:0;
            border-left:13px solid transparent;
            box-sizing: border-box;
            position: absolute;
            padding:2px 0 0 2px;
            list-style: none;
            margin:0;
        }
        .container ul li{
            float:left;
            width:33.3%;
            padding-top:45%;
            height:0;
            border-right:13px solid transparent;
            margin-bottom:15px;
            position: relative;
            box-sizing: border-box;
        }
        ul li div{
            background-color:rgba(112,134,156,1);
            position: absolute;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background-size:cover;
        }
    </style>
</head>
<body>
<div class="container">
    <ul>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
        <li>
            <div></div>
        </li>
    </ul>
</div>
<script>
    window.onload = function(){

        console.log('isPassiveSupported',isPassiveSupported());

        /**
         * 浏览器无法预先知道一个监听器会不会调用 preventDefault()，它需要等监听器执行完后，再去执行默认行为，而监听器执行是要耗时的，这样就会导致页面卡顿；
         * 简单来说，当你触摸滑动页面时，页面应该跟随手指一起滚动，而此时你绑定了wheel事件，事件逻辑大概执行200毫秒，在这期间浏览器对于页面是否滚动是无法确定的，比如如果在事件逻辑中调用了preventDefault()函数，页面就不应该滚动，如果没调用则应该滚动；
         * 而这个判断浏览器只有在事件逻辑执行完之后才能确定，因此会导致页面滚动卡顿和延迟。
         * 监听wheel事件时可以明显感觉到滚动卡顿，但是touch事件则不会。
         */

        document.addEventListener('wheel', function(){
            console.log('wheel');
            var start = window.performance.now();
            var end = start+100;

            //执行一段200ms耗时逻辑
            while(start<=end){
                start = window.performance.now();
            }
        //}, {passive:true});
        }, false);

        //判断是否支持passive
        function isPassiveSupported(){
            var passiveSupported = false;

            (function(){
                try{
                    var options = Object.defineProperty({},'passive',{
                        get:function(){
                            passiveSupported = true;
                        }
                    });

                    window.addEventListener('test',null,options);
                }catch(err){}
            })()

            return passiveSupported;
        }

    }
</script>
</body>
</html>
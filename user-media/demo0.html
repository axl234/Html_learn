<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>html5 UserMedia</title>
</head>
<body>
	<ul>
		<li>首先html5 UserMedia已经被Web标准废弃了</li>
		<li>该例子最好在Android设备的QQ中浏览</li>
		<li>就算部分浏览器支持，貌似正式发布时，也只能使用HTTPS协议</li>
	</ul>
	<video width="640" height="480" autoplay></video>
	<canvas width="640" height="480"></canvas>
	<script type="text/javascript">
		var video = document.querySelector('video');
		var canvas = document.querySelector('canvas');
		var context = canvas.getContext('2d');

		var exArray = []; //存储设备源ID
		MediaStreamTrack.getSources(function (sourceInfos) {
			for (var i = 0; i != sourceInfos.length; ++i) {
				var sourceInfo = sourceInfos[i];
				//这里会遍历audio,video，所以要加以区分
				if (sourceInfo.kind === 'video') {
					exArray.push(sourceInfo.id);
				}
			}

			navigator.webkitGetUserMedia({
				video: {
					optional:[{
						sourceId:exArray[1]//0为前置摄像头，1为后置
					}]
				}
			}, success, error);
		});

		function success(stream) {
		    video.src = window.webkitURL.createObjectURL(stream);
		    video.onloadedmetadata = function(e) {
		    	renderCanvas();
		    };
	    }

	    function error(err) {
	        alert('video error: ' + err)
	    }

	    function renderCanvas(){//使用canvas定时抓取vedio
	    	setInterval(function(){
	    		context.drawImage(video, 0, 0, 640, 480);
	    	},1000);
	    }
	</script>
</body>
</html>
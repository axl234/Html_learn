<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>影响canvas动画性能的因素</title>
	<script type="text/javascript" src="/node_modules/jquery/dist/jquery.min.js"></script>
	<style type="text/css">
		html{
			font-size:42px;
		}
		.roll-container{
			background-color:#eee;
			width:100%;
			height:3.24rem;
			margin:0 auto;
			box-shadow: inset 0 15px 15px -5px #fff,inset 0 -15px 15px -5px #fff;
		}
		.roll-container .item{
			width:1.24rem;
			height:3.24rem;
		}
        .tips{
            font-size:0.3rem;
            margin-top:2rem;
        }
	</style>
</head>
<body>
    <ul class="tips">
       <li>运动的元素越多性能越低，内存消耗越大（很容理解）</li>
       <li>资源越大性能越低，内存消耗越大（与浏览器图片解码有关，浏览器解码所需时间和图片的类型以及尺寸有关）</li>
       <li>画布尺寸越大性能越低，内存消耗越大（与浏览器的绘制有关）</li>
       <li>setInterval和setTimeout方法容易丢帧</li>
    </ul>
	<div class="roll-container">
		<canvas index="0" class="item" width="124" height="324"></canvas>
		<canvas index="1" class="item" width="124" height="324"></canvas>
		<canvas index="2" class="item" width="124" height="324"></canvas>
		<canvas index="3" class="item" width="124" height="324"></canvas>
		<canvas index="4" class="item" width="124" height="324"></canvas>
		<canvas index="5" class="item" width="124" height="324"></canvas>
		<canvas index="6" class="item" width="124" height="324"></canvas>
		<canvas index="7" class="item" width="124" height="324"></canvas>
		<canvas index="8" class="item" width="124" height="324"></canvas>
		<canvas index="9" class="item" width="124" height="324"></canvas>
		<canvas index="10" class="item" width="124" height="324"></canvas>
		<canvas index="11" class="item" width="124" height="324"></canvas>
		<canvas index="12" class="item" width="124" height="324"></canvas>
		<canvas index="13" class="item" width="124" height="324"></canvas>
		<canvas index="14" class="item" width="124" height="324"></canvas>
		<canvas index="15" class="item" width="124" height="324"></canvas>
	</div>
	<script type="text/javascript">
		javascript:(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';document.head.appendChild(script);})()
	</script>
	<script type="text/javascript">
		$(document).ready(function(){

			var listImg = new Image();
			initRoll();
			var rollCanvas = document.querySelectorAll('div.roll-container canvas.item');

			function initRoll(){
				listImg.src = './list.png';
				listImg.onload = function(){
					for(var i=0;i<rollCanvas.length;i++){
						var context = rollCanvas[i].getContext('2d');
						context.clearRect(0,0,124,324);
						context.drawImage(listImg,0,0,124,324,0,0,124,324);
					}
				}
			}

	    	function startRoll(){//开始滚动动画
	            for(var i=0;i<rollCanvas.length;i++){
	                var context = rollCanvas[i].getContext('2d');
	                roll(context,0);
	            }
	    	}

	        function roll(context,delay){
	            var basic = 1000;
	            var speed = 100;
	            var up = 1;
	            var y = 0;
	            var time = 0;
	            var item = 50;
	            (function(context,speed,up,y,time,item,delay){
	                setInterval(function(){
	                    context.clearRect(0,0,124,324);
	                    time = time+item;
	                    if(time>delay){
	                        if(time<2000){//加速阶段
	                            speed = speed+up*item
	                        }else if(time>=2000){//等待抽奖结果阶段
	                            speed = speed
	                        }
	                        y = y+speed*item;
	                        var y1 = y%(1071*basic);
	                        if(y1<=747*basic){
	                            context.drawImage(listImg,0,y1/basic,124,324,0,0,124,324);
	                        }else{
	                            var y2 = 1071*basic-y1;
	                            context.drawImage(listImg,0,y1/basic,124,y2/basic,0,0,124,y2/basic);
	                            var y3 = 324*basic-y2;
	                            context.drawImage(listImg,0,0,124,y3/basic,0,y2/basic,124,y3/basic);
	                        }
	                    }
	                },item)
	            })(context,speed,up,y,time,item,delay);
	        }

	    	startRoll();
		});
	</script>
</body>
</html>
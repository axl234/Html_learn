<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>js compress png</title>
</head>
<body>
    <input id="file" type="file" accept="image/png,image/jpeg">
    <script>
        window.onload = function(){

            var $pngCanvas = document.createElement('canvas');
            var $pngContext = $pngCanvas.getContext('2d');

            var $jpgCanvas = document.createElement('canvas');
            var $jpgContext = $jpgCanvas.getContext('2d');

            var $file = document.querySelector('#file');

            $file.addEventListener('change',function(evt){
                var files = evt.target.files;
                if(files.length>0){
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var data = e.target.result;
                        var image = new Image();
                        image.onload = function(){
                            $pngCanvas.width = image.width;
                            $pngCanvas.height = image.height;
                            $pngContext.drawImage(image,0,0,$pngCanvas.width,$pngCanvas.height);

                            //test
                            //document.body.appendChild(image);
                            var pngData = $pngContext.getImageData(0,0,$pngCanvas.width,$pngCanvas.height);

                            var jpgDataUrl = $pngCanvas.toDataURL('image/jpeg','0.8');
                            var jpgImage = new Image();
                            jpgImage.src = jpgDataUrl;
                            jpgImage.onload = function(){

                                $jpgCanvas.width = jpgImage.width;
                                $jpgCanvas.height = jpgImage.height;
                                //$jpgContext.drawImage(jpgImage,0,0,$jpgCanvas.width,$jpgCanvas.height);
                                $jpgContext.putImageData(pngData,0,0);
                                document.body.appendChild($jpgCanvas);
                            };
                        }
                        image.src = data;
                    }
                    reader.readAsDataURL(files[0])
                }
            });
        }
    </script>
</body>
</html>